name: üì± Build Debug APK v2 (Guaranteed Success)
on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v4
      
    - name: ‚òï Setup Java 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: üîß Setup Android SDK
      uses: android-actions/setup-android@v3
      with:
        api-level: 34
        build-tools: 34.0.0
        
    - name: üìã Cache Gradle dependencies
      uses: actions/cache@v4
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
          
    - name: üîë Make gradlew executable
      run: chmod +x gradlew
      
    - name: üßπ Clean project
      run: ./gradlew clean
      
    - name: üèóÔ∏è Build Debug APK
      run: |
        echo "Building debug APK..."
        ./gradlew assembleDebug --stacktrace --info
        
    - name: üìÅ List APK files
      run: |
        echo "Listing all APK files:"
        find . -name "*.apk" -type f
        ls -la app/build/outputs/apk/debug/ || echo "Debug folder not found"
        
    - name: üì¶ Upload Debug APK
      uses: actions/upload-artifact@v4
      with:
        name: EmailAssistant-Debug-APK-v2
        path: |
          app/build/outputs/apk/debug/*.apk
          app/build/outputs/apk/**/*.apk
        retention-days: 30
        if-no-files-found: warn
        
    - name: üìã Build Summary
      run: |
        echo "üéâ Build completed!"
        echo "üì± APK Type: Debug (for testing)"
        echo "üì• Download: Go to Actions > Artifacts"
        echo "üîß Install: Enable 'Unknown sources' on Android"
        echo ""
        echo "‚úÖ Features included:"
        echo "   - Voice recognition in Portuguese"
        echo "   - AI email analysis"
        echo "   - Microsoft Outlook integration"
        echo "   - Text-to-speech"
        echo "   - Hands-free mode"
        echo ""
        echo "‚ö†Ô∏è  Note: This is a DEBUG APK for testing"
        echo "   For production APK, configure GitHub secrets"

